datasource db {
    url      = env("DATABASE_URL")
    provider = "mysql"
}

generator client {
    provider = "prisma-client-js"
}

model Student {
    id           Int           @id @default(autoincrement())
    firstname    String
    surename     String
    class        String?
    extendedMath Boolean?
    description  String?
    defaultPrice Float?
    ContactData  ContactData[]
    Payment      Payment[]
    Lesson       LessonData[]
}

model ContactData {
    id        Int         @id @default(autoincrement())
    type      ContactType
    value     String
    studentId Int
    student   Student     @relation(fields: [studentId], references: [id])
}

enum ContactType {
    PHONE
    EMAIL
    FACEBOOK
    DISCORD
}

model Payment {
    id        Int      @id @default(autoincrement())
    studentId Int
    price     Int
    date      DateTime
    student   Student  @relation(fields: [studentId], references: [id])
}

model LessonData {
    id     Int     @id @default(autoincrement())
    price  Float
    isPaid Boolean @default(false)

    studentId Int
    student   Student @relation(fields: [studentId], references: [id])

    eventId Int   @unique
    event   Event @relation(fields: [eventId], references: [id])
}

model Event {
    id           Int       @id @default(autoincrement())
    date         DateTime
    isCanceled   Boolean   @default(false)
    isOverridden Boolean   @default(false)
    type         EventType

    lessonData LessonData?

    eventSeriesId Int?
    eventSeries   EventSeries? @relation(fields: [eventSeriesId], references: [id])

    name        String
    description String?
    startHour   String?
    endHour     String?
}

model EventSeries {
    id         Int             @id @default(autoincrement())
    type       EventSeriesType
    pattern    String?
    startDate  DateTime?
    endDate    DateTime?
    isCanceled Boolean         @default(false)

    name        String
    description String?
    startHour   String?
    endHour     String?

    events Event[]
}

//TODO - make possible to user create own event types
enum EventType {
    DEFAULT
    LESSON
}

enum EventSeriesType {
    DAILY
    WEEKLY
    MONTHLY
    YEARLY
}
